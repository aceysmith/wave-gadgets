<Module>
  <ModulePrefs title="Title" height="250">
    <Require feature="rpc"/>
  </ModulePrefs>

  <Content type="html">
  <![CDATA[

  <script type="text/javascript"
      src="http://wave-api.appspot.com/public/wave.js"></script>
  <script type="text/javascript">
    function assignTitle() 
    {
      var title = document.getElementById('new_title').value;
      alert('putting new title');
      var state = wave.getState();
      var delta = {};
      delta[title] = title;
      state.submitDelta(delta);
      document.getElementById('poll_title').innerHTML = title;
      alert(delta[title]);
    }

    function render()
    {
      if(!wave.getState())
      {
        return;
      }
      alert('first render with state');
      var state = wave.getState();
      var title = state.get(title, '0');
      alert(title);
      if(title != '0')
      {
        document.getElementById('poll_title').innerHTML = title;
      }
    }

    function init()
    {
      if(wave && wave.isInWaveContainer())
      {
        wave.setStateCallback(render);
        wave.setParticipantCallback(render);
      }
    }

    gadgets.util.registerOnLoadHandler(init);
  </script>
  <span id="poll_title">What is the poll called?</span>
  <input id="new_title" size="10">
  <button id="butCount" onclick="assignTitle()">Start the poll</button><br/>


]]>
</Content>
</Module>