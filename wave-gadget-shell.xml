<Module>
  <ModulePrefs title="Title" height="100">
    <Require feature="rpc"/>
  </ModulePrefs>

  <Content type="html">
  <![CDATA[

  <script type="text/javascript" src="http://wave-api.appspot.com/public/wave.js"></script>
  <script type="text/javascript" src="jquery-1.3.2.min.js"></script>

  <script type="text/javascript">
    function assignTitle() 
    {
      var title = document.getElementById('new_title').value;
      var state = wave.getState();
      var delta = {};
      delta['title'] = title;
      state.submitDelta(delta);
    }
    function addEntry()
    {
      var state = wave.getState();
      var entries = state.get('entries', false);
      var entryCount = 0;
      if(entries)
      {
        entryCount = entries.length;
        alert('actual entries!');
      }
      var newEntry = document.getElementById('new_entry').value;
      var entryName = 'entry' + entryCount;
      alert(entries);
      alert(entryName);

      var delta = {};
      delta['entries'] = { entryName : 'newEntry' };
      alert(delta['entries']);
      state.submitDelta(delta);
    }

    function render()
    {
      if(!wave.getState())
      {
        return;
      }
      var state = wave.getState();
      var title = state.get('title', false);
      var entries = state.get('entries', false);
      if(title)
      {
        document.getElementById('strowl_poll').innerHTML = title + "<br /><input id='new_entry' size='30'><button onclick='addEntry()'>Add entry</button><br /><div id='entries'></div>";
        if(entries)
        {
          for(var i = 0; i < entries.length; i++)
          {
            document.getElementById('entries').innerHTML = i;
          }
        }
      }
    }

    function init()
    {
      if(wave && wave.isInWaveContainer())
      {
        wave.setStateCallback(render);
        wave.setParticipantCallback(render);
      }
    }
    gadgets.util.registerOnLoadHandler(init);
  </script>
  
  <div id="strowl_poll">
    <span id="poll_title">What is the poll question?</span>
    <br />
    <input id="new_title" size="30">
    <button onclick="assignTitle()">Start the poll</button><br/>
  </div>

]]>
</Content>
</Module>