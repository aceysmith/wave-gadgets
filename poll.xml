<Module>
  <ModulePrefs title="Title" height="100">
    <Require feature="rpc"/>
  </ModulePrefs>

  <Content type="html">
  <![CDATA[

  <script type="text/javascript" src="http://wave-api.appspot.com/public/wave.js"></script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"></script>

  <script type="text/javascript">
    $("#title_button").live('click', function()
    {
      var title = $('#new_title').val();
      var state = wave.getState();
      var delta = {};
      delta['title'] = title;
      state.submitDelta(delta);
    });

    $("#new_answer_button").live('click', function()
    {
      var state = wave.getState();
      var answerCount = parseInt(state.get('answerCount', '0')) + 1;
      var newAnswer = $('#new_answer').val();
      var answerName = 'answer' + answerCount;
      var delta = {};
      delta['answerCount'] = answerCount;
      delta[answerName] = newAnswer;
      state.submitDelta(delta);
    });

    function render()
    {
      if(!wave.getState())
      {
        return;
      }
      var state = wave.getState();
      var title = state.get('title', false);
      if(title)
      {
        $('#strowl_poll').html(title + "<br /><input id='new_answer' size='30'><button id='new_answer_button'>Add answer</button><br /><div id='answers'></div>");
        var keys = state.getKeys();
        $('#answers').html('');
        for(i=2; i < keys.length; i++)
        {
          key = keys[i];
          value = state.get(key);
          $('#answers').append(value + "<br />");
        }
      }
    }
    
    function init()
    {
      if(wave && wave.isInWaveContainer())
      {
        wave.setStateCallback(render);
        wave.setParticipantCallback(render);
      }
    }
    gadgets.util.registerOnLoadHandler(init);
  </script>  
  
  
  <div id="strowl_poll">
    <span id="poll_title">What is the poll question?</span>
    <br />
    <input id="new_title" size="30">
    <button id="title_button">Start the poll</button><br/>
  </div>
  ]]>
  </Content>
</Module>